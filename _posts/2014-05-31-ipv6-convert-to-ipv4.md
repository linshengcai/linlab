---
layout: post
title: Ipv6转Ipv4
categories: [计算机网络]
tags: IPV4
---

昨晚将Ubuntu从12.04升级到了14.04，同样，14.04支持5年，用了一个晚上，无论是从性能还是界面华丽程度，14.0挺不错的。真是许久不用Ubuntu,生疏了很多。上次进入Ubuntu系统大概有两个月之前了，之所以一直没进Ubuntu，是由于在Windows里一直采用的是由Ipv6转Ipv4，每个月可以省一笔网费，而Ubuntu下网络一直未解决。昨晚心血来潮，把12.04清理了一下，结果系统清出问题来了，索性六维上下了14.04，把系统升级一下。系统升级完后，估摸了一下Winodws下Ipv6转Ipv4的技术实现，心里大概对它有了个底。

说起蹭网这事，本小子可是劣迹斑斑，大学时在学校申请了个静态IP，从此本小子的网络流量无限制了（学校当时规定每人每月送3G的流量），不过那时本小子对网络的依赖程度不及现在，所以即便是变成了无限制，每月还是没有用完3G的流量。这次又误打误撞，掌握了这么一个小trick。好了，不啰里吧嗦的了，简单记录一下从Ipv6转Ipv4的技术实现及原理，Windows下转换技术与此类似。

首先在网络设置里禁用Ipv4,如下图所示：

![]({{ site.url }}/public/images/posts/ipv6-ipv4.png)

禁用Ipv4后，紧接着设置Ipv6:

![]({{ site.url }}/public/images/posts/ipv6-convert-ipv4.png)

这里，Ipv6地址采取自动获取的方式，DNS服务器为该配置过程的关键点，这里DNS服务器地址采用的是`2001:778::37`，配置完成后，保存即可。完成这些步骤后，便可以通过Ipv6转Ipv4实现Ipv4地址访问。

这里，之所以要禁用Ipv4，本小子的理解是，通过使用Ipv4，使在访问Ipv4地址时，强制进行转换，如果你不禁用Ipv4的话，则打开浏览网址会自动跳转到账号登陆页面，从而无法实现Ipv6转Ipv4。

上面讲的是技术实现，Windows下设置与上面的类似。下面再来了解一下转换的原理。
>当IPv6 Only User发起连接访问普通IPv6网站，流量将会匹配IPv6默认路由而直接转发至IPv6 Router处理。而访问的是IPv4单协议栈的服务器时，将经DNS64 Server进行前缀合成，Pref64::/n网段的流量将被路由转发至NAT64 Router上，从而实现IPv6与IPv4地址和协议的转换，访问IPv4 网络中的资源。

上面大概说明了通过NAT64和DNS64进行转换的原理。具体可以参阅[NAT64与DNS64基本原理概述](http://www.ipv6bbs.cn/thread-170-1-1.html)，如果想要了解更多的话，可以google NAT64与DNS64。

采用转换IP地址的方法，无妨登陆WebQQ，估计是Tencent采用的协议不一致的原因，具体还有待考证。好了，关于Ipv6转Ipv4就记录这么多。
